name: opencode

on:
  issues:
    types: [opened]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened, synchronize, reopened, ready_for_review]

jobs:
  opencode:
    if: >-
      ${{ github.event_name != 'issue_comment' ||
        contains(github.event.comment.body, '/oc') ||
        contains(github.event.comment.body, '/opencode') }}
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
      pull-requests: write
      issues: write
    steps:
      - uses: actions/checkout@v6
        with:
          persist-credentials: false

      - uses: anomalyco/opencode/github@latest
        env:
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          model: anthropic/claude-opus-4-5
          use_github_token: true
          prompt: |
            Auto-review this PR or issue. Only comment if you can help.
            Do not modify files, open PRs, or push code.
            so if we are merging. always provide concise extended description to add in code block type
            since we dont want to edit commit message this will help history tracking to be accurate.

            For Issues specifically, provide recommendation on how to break problems down, not run into a ditch
            issues are used to drive building on this codebase so that agents dont run into a ditch and its important
            we understand whats going on.
